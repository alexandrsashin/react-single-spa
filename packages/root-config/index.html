<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Root Config</title>

    <!-- Environment detection and importmap loader -->
    <script src="/src/importmap-loader.js"></script>

    <!-- This script is required for react-refresh to work properly -->
    <script>
      const origins = ["http://localhost:3006", "http://localhost:3007"];

      function appendReactRefreshScript(origin) {
        const reactRefreshInteropabilityScript =
          document.createElement("script");
        reactRefreshInteropabilityScript.type = "module";
        reactRefreshInteropabilityScript.textContent = `
    import RefreshRuntime from '${origin}/@react-refresh';
    RefreshRuntime.injectIntoGlobalHook(window);
  `;
        document.head.appendChild(reactRefreshInteropabilityScript);
      }

      window.$RefreshReg$ = () => {};
      window.$RefreshSig$ = () => (type) => type;
      window.__vite_plugin_react_preamble_installed__ = true;

      // Only setup React Refresh in development
      if (
        window.location.hostname === "localhost" ||
        window.location.hostname === "127.0.0.1"
      ) {
        origins.forEach((origin) => {
          appendReactRefreshScript(origin);
        });
      }
    </script>

    <!-- Dynamic importmap loading -->
    <script>
      // Load importmap before any module imports
      window
        .loadImportMap()
        .then(() => {
          console.log("Environment:", window.getEnvironment());
          // Import root config after importmap is loaded
          import("root-config").catch((err) => {
            console.error("Failed to load root-config:", err);
          });
        })
        .catch((err) => {
          console.error(
            "Failed to load importmap, falling back to static:",
            err
          );
          // Fallback: try to import anyway
          import("root-config").catch((importErr) => {
            console.error(
              "Failed to load root-config even with fallback:",
              importErr
            );
          });
        });
    </script>
  </head>

  <body>
    <noscript> You need to enable JavaScript to run this app. </noscript>

    <!-- Development tools -->
    <import-map-overrides-full
      show-when-local-storage="devtools"
      dev-libs
    ></import-map-overrides-full>
  </body>
</html>

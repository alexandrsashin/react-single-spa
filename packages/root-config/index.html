<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Root Config</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- React Refresh Setup (development only) -->
    <script src="/importmap-loader.js"></script>

    <!-- This script is required for react-refresh to work properly -->
    <script>
      (async function () {
        // React refresh Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ dev Ñ€ÐµÐ¶Ð¸Ð¼Ð° (ÐºÐ¾Ð³Ð´Ð° ÐµÑÑ‚ÑŒ Vite HMR)
        const isDev =
          window.location.port >= 3000 && window.location.port < 4000;

        if (!isDev) {
          console.log("[react-refresh] skipping in production mode");
          return;
        }

        try {
          const { setupReactRefresh } = await import("/react-refresh-setup.js");
          setupReactRefresh();
        } catch (error) {
          // ÐÐµ Ð»Ð¾Ð¼Ð°ÐµÐ¼ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð¸Ð·-Ð·Ð° Ð½ÐµÑÑƒÑ‰ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð¹ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
          console.warn("[react-refresh] failed to load:", error);
        }
      })();
    </script>

    <!-- Dynamic importmap loading -->
    <script>
      // Load importmap before any module imports
      window
        .loadImportMap()
        .then(() => {
          console.log("ðŸš€ Starting application...");
          // Import root config after importmap is loaded
          // Tell Vite to ignore rewriting this specifier so the importmap
          // entry for "root-config" can take effect at runtime.
          import(/* @vite-ignore */ "root-config").catch((err) => {
            console.error("Failed to load root-config:", err);
          });
        })
        .catch((err) => {
          console.error(
            "Failed to load importmap, falling back to static:",
            err
          );
          // Fallback: try to import anyway with dev path for localhost:3000
          const isDev =
            window.location.port >= 3000 && window.location.port < 4000;
          const specifier = isDev ? "/src/main.ts" : "root-config";

          import(/* @vite-ignore */ specifier).catch((importErr) => {
            console.error(
              "Failed to load root-config even with fallback:",
              importErr
            );
          });
        });
    </script>
  </head>

  <body>
    <noscript> You need to enable JavaScript to run this app. </noscript>

    <!-- Development tools -->
    <import-map-overrides-full
      show-when-local-storage="devtools"
      dev-libs
    ></import-map-overrides-full>
  </body>
</html>
